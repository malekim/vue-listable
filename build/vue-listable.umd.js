!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).VueListable=t()}(this,(function(){"use strict";var e={render:function(e){if(this.expanderSlot)return e("tr",{class:{"listable-tr":!0,"listable-tr-expander":!0}},[e("td",{class:["listable-td"],attrs:{colspan:this.colspan}},this.expanderSlot(this.row))])},props:{colspan:{type:Number,default:0},row:{type:Object,default:function(){}},expanderSlot:{type:Function,default:function(){}}}},t=function(){function e(e,t,s,n,i,a){this.searchable=!!e,this.isCheckbox=!!t,this.display=s,this.sortable=!!n,this.column=i,this.ascending=void 0===a||!!a,this.descending=!this.ascending,this.defaultAscending=!!this.ascending,this.calculateClasses()}return e.prototype.oppositeSort=function(){this.descending=!this.descending,this.ascending=!this.ascending,this.calculateClasses()},e.prototype.resetSort=function(){this.ascending=this.defaultAscending,this.descending=!this.defaultAscending,this.calculateClasses()},e.prototype.calculateClasses=function(){this.classes={"listable-th":!0,"listable-th-checkbox":this.isCheckbox,sortable:this.sortable,ascending:this.sortable&&this.ascending,descending:this.sortable&&this.descending}},e}(),s={components:{Expander:e},render:function(e){return e("div",{class:"listable-container",ref:"container"},[this.generateTable(e),this.generatePaginator(e)])},props:{headings:{type:Array,default:function(){return[]}},data:{type:Array,default:function(){return[]}},checkbox:{type:Boolean,default:!1},expandable:{type:Boolean,default:!1},responsive:{type:Boolean,default:!0}},data:function(){return{columns:[],checked:[],expanded:[],searchable:!1,searched:{},searchTimeout:null,resizeTimeout:null,responsiveMode:!1,responsiveMaxWidth:1/0}},mounted:function(){var e=this;this.$nextTick((function(){e.checkErrors(),e.columns=e.calculateColumns(),e.searchable=e.isSearchable(),e.responsive&&window.addEventListener("resize",e.handleResponsive)}))},methods:{calculateColumns:function(){var e=[];if(this.checkbox){var s=new t(!1,!0,"",!1,"",!0);e.push(s)}for(var n in this.headings){var i=new t(this.headings[n].search,!1,this.headings[n].display,this.headings[n].sortable,this.headings[n].column,this.headings[n].ascending);e.push(i)}return e},checkErrors:function(){this.data.length>0&&this.headings.length!==this.data[0].length&&console.error("Header's row length ("+this.headings.length+") and body's row length ("+this.data[0].length+") are not equal.")},generateTable:function(e){var t=this.generateHeader(e),s=this.generateBody(e);return e("table",{class:{listable:!0,"responsive-mode":this.responsiveMode},ref:"table"},[t,s])},generateHeader:function(e){return e("thead",{class:"listable-header"},this.generateHeaderRows(e))},generateHeaderRows:function(e){var t=[];return t.push(e("tr",{class:{"listable-tr":!0,"listable-tr-checked":this.checked.length>0&&this.checked.length===this.data.length}},[this.generateHeaderCells(e)])),this.searchable&&this.data.length>0&&t.push(e("tr",{class:{"listable-tr":!0,"listable-tr-checked":this.checked.length>0&&this.checked.length===this.data.length,"listable-tr-search":!0}},[this.generateHeaderSearchCells(e)])),t},isSearchable:function(){for(var e in this.headings)if(this.headings[e].search)return!0;return!1},generateHeaderSearchCells:function(e){var t=this,s=[],n=function(n){var i=[];t.columns[n].searchable&&i.push(e("input",{class:"listable-search",on:{input:function(e){clearTimeout(t.searchTimeout),t.searchTimeout=setTimeout((function(){t.$emit("input",e.target.value),t.searched[t.headings[n].column]=e.target.value,t.$emit("search",t.searched)}),500)}}}));var a=e("th",{class:["listable-th"]},i);s.push(a)};for(var i in t.columns)n(i);return s},generateHeaderCells:function(e){var t=this,s=[],n=function(n){var i=[];if(t.columns[n].isCheckbox){if(0==t.data.length)return;i.push(e("span",{class:{"listable-checkbox":!0},on:{click:t.handleAllCheckbox}}))}t.columns[n].display&&i.push(t.columns[n].display);var a={};t.columns[n].sortable&&(a.click=function(e){t.handleSort(e,n)});var r=e("th",{class:t.columns[n].classes,on:a},i);s.push(r)};for(var i in t.columns)n(i);return s},generateBody:function(e){return e("tbody",{class:"listable-body"},this.generateBodyRows(e))},handleCheckbox:function(e,t){e.stopPropagation();var s=this.checked.indexOf(t);-1!==s?this.checked.splice(s,1):this.checked.push(t),this.$emit("checked",this.checked)},handleSort:function(e,t){e.stopPropagation();var s=this.columns[t];this.columns.map((function(e){e.column!=s.column&&e.resetSort()})),this.columns[t].oppositeSort();var n={column:s.column,ascending:s.ascending};this.$emit("sorted",n),this.$forceUpdate()},handleAllCheckbox:function(e){if(e.stopPropagation(),this.checked.length>0)this.checked=[];else for(var t in this.checked=[],this.data)this.checked.push(t);this.$emit("checked",this.checked)},generateEmptyRow:function(e){return e("tr",{class:{"listable-tr":!0,"listable-tr-empty":!0}},[e("td",{class:"listable-td",attrs:{colspan:this.columns.length}},[this.$slots.empty])])},generateBodyRows:function(e){var t=this,s=[];0==this.data.length&&s.push(this.generateEmptyRow(e));var n=function(n){t.responsiveMode&&s.push(e("tr",{class:{"listable-tr-checkbox":!0,"listable-tr-checked":-1!==t.checked.indexOf(n)}},[e("td",{class:{"listable-checkbox":!0},on:{click:function(e){return t.handleCheckbox(e,n)}}})]));var i="tr_"+n;s.push(e("tr",{class:{"listable-tr":!0,"listable-tr-checked":-1!==t.checked.indexOf(n)},on:{click:function(e){if(e.stopPropagation(),t.expandable){var s=t.expanded.indexOf(n);-1!==s?t.expanded.splice(s,1):t.expanded.push(n),t.$emit("expanded",t.expanded)}}},ref:i},t.generateBodyRowCells(e,n,t.data[n]))),t.expandable&&-1!==t.expanded.indexOf(n)&&s.push(t.generateExpander(e,t.data[n]))};for(var i in t.data)n(i);return s},generateBodyRowCells:function(e,t,s){var n=this,i=[];this.checkbox&&i.push(e("td",{class:"listable-td listable-td-checkbox"},[e("td",{class:"listable-checkbox",on:{click:function(e){return n.handleCheckbox(e,t)}}})]));var a=function(a){var r=n.headings[a].column,o=null,l="td_"+t+"_"+a,c=null;if(n.responsiveMode&&(c=e("div",{class:["listable-td-th"]},n.headings[a].display)),n.$scopedSlots[r]){var h=n.$scopedSlots[r](s);o=e("td",{class:["listable-td"],style:[],ref:l},[c,h])}else o=e("td",{class:["listable-td"],style:[],ref:l},[c,void 0===s[r]||null===s[r]?"":s[r].constructor===Array?"":s[r].constructor===Object?"":s[r]]);i.push(o),n.$nextTick((function(){n.$emit("hook",n.$refs[l],r,s)}))};for(var r in n.headings)a(r);return i},generateExpander:function(e,t){if(this.$scopedSlots.expander)return e("Expander",{props:{colspan:this.columns.length,expanderSlot:this.$scopedSlots.expander,row:t}})},generatePaginator:function(e){return this.$slots.paginator?e("div",{class:"listable-paginator"},this.$slots.paginator):null},handleResponsive:function(){var e=this;clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout((function(){var t=window.innerWidth;if(e.$refs.container){var s=e.$refs.container.clientWidth,n=e.$refs.table.clientWidth;t>e.responsiveMaxWidth&&(e.responsiveMode=!1),n>s&&(e.responsiveMaxWidth=t,e.responsiveMode=!0)}}),100)}},updated:function(){var e=this;this.$nextTick((function(){e.handleResponsive()}))},beforeDestroy:function(){this.responsive&&window.removeEventListener("resize",this.handleResponsive)}};return{install:function(e,t){e.component("listable",s)}}}));
